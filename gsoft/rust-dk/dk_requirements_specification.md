# 功能需求規格書 - dk Docker 管理工具

## 1. 簡介

本文件旨在定義 dk 主控台應用程式的功能需求。dk 是一個用 Rust 語言開發的命令列工具，旨在提供一個更友善且互動式的介面來管理 Docker 容器。

## 2. 應用程式資訊

- **應用程式名稱**: dk
- **開發語言**: Rust
- **目標平台**: Linux、macOS、Windows

## 3. 功能需求

### 3.1. 無輸入參數 (`dk`)

**描述**: 當使用者執行 `dk` 而不帶任何參數時，應用程式應擷取並顯示當前 Docker 容器的狀態。

**資料來源**: 透過 Docker API 或執行 `docker ps` 命令取得資料。

**顯示內容**:

#### 活動中的容器 (Running Containers)
- Container ID
- Name
- Bind Port (綁定埠)
- Start Status (啟動狀態)
- Start At Time (啟動時間)

#### 非活動中的容器 (Exited/Stopped Containers)
- Container ID
- Name
- Bind Port (綁定埠)
- Exit Status (退出狀態)
- Stop At Time (停止時間)

**顯示格式**: 所有資訊應以表格形式清晰顯示。

### 3.2. 輸入參數 logs (`dk logs`)

**描述**: 當使用者執行 `dk logs` 時，應用程式應列出所有活動中和非活動中的 Docker 容器，並提供互動式選取和過濾功能，以便檢視特定容器的日誌。

**顯示內容**:
- Container ID
- Name
- Bind Port (綁定埠)
- Start/Exit Status (啟動/退出狀態)
- Start/Stop Time (啟動/停止時間)

**互動功能**:
- **列表顯示**: 顯示所有容器的清單
- **高亮度選取**: 預設高亮度清單中的第一個項目
- **移動選取**: 使用上下箭頭鍵移動高亮度的選取項目
- **執行日誌**: 當高亮度選取某個容器後，按下 ENTER 鍵，應用程式應執行 `docker logs <container_id>` 並顯示該容器的日誌
- **關鍵字過濾**: 允許使用者輸入關鍵字。當輸入關鍵字時，清單應即時過濾，只顯示名稱或 ID 包含該關鍵字的活動中及非活動中容器。過濾後，高亮度選取功能仍應正常運作

### 3.3. 輸入參數 bash (`dk bash`)

**描述**: 當使用者執行 `dk bash` 時，應用程式應列出所有活動中和非活動中的 Docker 容器，並提供互動式選取和過濾功能，以便進入特定容器的 Bash 環境。

**顯示內容**:
- Container ID
- Name
- Bind Port (綁定埠)
- Start/Exit Status (啟動/退出狀態)
- Start/Stop Time (啟動/停止時間)

**互動功能**:
- **列表顯示**: 顯示所有容器的清單
- **高亮度選取**: 預設高亮度清單中的第一個項目
- **移動選取**: 使用上下箭頭鍵移動高亮度的選取項目
- **進入 Bash**: 當高亮度選取某個容器後，按下 ENTER 鍵，應用程式應執行 `docker exec -it <container_id> bash` (或 `sh`，如果 bash 不可用) 進入該容器的命令列環境
- **關鍵字過濾**: 允許使用者輸入關鍵字。當輸入關鍵字時，清單應即時過濾，只顯示名稱或 ID 包含該關鍵字的活動中及非活動中容器。過濾後，高亮度選取功能仍應正常運作

### 3.4. 輸入參數 rm (`dk rm`)

**描述**: 當使用者執行 `dk rm` 時，應用程式應列出所有 Docker 容器，並提供互動式選取功能，以便安全地移除選定的容器。

**顯示內容**:
- Container ID
- Name
- Bind Port (綁定埠)
- Start/Exit Status (啟動/退出狀態)
- Start/Stop Time (啟動/停止時間)

**互動功能**:
- **列表顯示**: 顯示所有容器的清單
- **高亮度選取**: 允許使用者高亮度選取一個或多個項目 (例如，使用空格鍵進行多選)
- **確認移除**: 在使用者確認後，對選定的每個容器執行 `docker rm <container_id>`。應提供一個確認提示 (例如，"確定要移除選定的容器嗎？[Y/n]")

### 3.5. 輸入參數 rm -f (`dk rm -f`)

**描述**: 當使用者執行 `dk rm -f` 時，應用程式應列出所有 Docker 容器，並提供互動式選取功能，以便強制移除選定的容器。

**顯示內容**:
- Container ID
- Name
- Bind Port (綁定埠)
- Start/Exit Status (啟動/退出狀態)
- Start/Stop Time (啟動/停止時間)

**互動功能**:
- **列表顯示**: 顯示所有容器的清單
- **高亮度選取**: 允許使用者高亮度選取一個或多個項目 (例如，使用空格鍵進行多選)
- **強制移除**: 在使用者確認後，對選定的每個容器執行 `docker rm -f <container_id>`。應提供一個確認提示 (例如，"確定要強制移除選定的容器嗎？[Y/n]")

### 3.6. 輸入參數 restart (`dk restart`)

**描述**: 當使用者執行 `dk restart` 時，應用程式應列出所有 Docker 容器，並提供互動式選取功能，以便重新啟動選定的容器。

**顯示內容**:
- Container ID
- Name
- Bind Port (綁定埠)
- Start/Exit Status (啟動/退出狀態)
- Start/Stop Time (啟動/停止時間)

**互動功能**:
- **列表顯示**: 顯示所有容器的清單
- **高亮度選取**: 允許使用者高亮度選取一個或多個項目 (例如，使用空格鍵進行多選)
- **重新啟動**: 在使用者確認後，對選定的每個容器執行 `docker restart <container_id>`。應提供一個確認提示 (例如，"確定要重新啟動選定的容器嗎？[Y/n]")

## 4. 技術考量

### 4.1. Docker 互動
應用程式應能透過 Docker API (推薦) 或直接呼叫 docker 命令列工具來與 Docker 守護程式互動。

### 4.2. 主控台 UI
應使用 Rust 的終端機 UI 函式庫 (例如 tui-rs 或類似的庫) 來實現互動式清單、高亮度選取和輸入過濾功能。

### 4.3. 錯誤處理
應用程式應妥善處理 Docker 命令執行失敗、網路問題或無效容器 ID 等錯誤情況，並向使用者提供友善的錯誤訊息。

### 4.4. 跨平台
考慮在 Linux、macOS 和 Windows 上運行的相容性。

## 5. 使用者介面設計原則

### 5.1. 一致性
所有互動式功能應保持一致的操作方式：
- 上下箭頭鍵用於導航
- ENTER 鍵用於確認選擇
- 空格鍵用於多選 (適用時)
- ESC 鍵用於取消操作

### 5.2. 回饋機制
- 提供清晰的視覺回饋，顯示當前選中的項目
- 在執行操作前提供確認提示
- 顯示操作進度和結果

### 5.3. 錯誤處理
- 提供友善且具體的錯誤訊息
- 在可能的情況下提供解決建議
- 優雅地處理 Docker 服務不可用的情況

## 6. 效能要求

- 容器列表載入時間應在 2 秒內完成
- 互動式操作應有即時回應 (< 100ms)
- 支援處理大量容器 (100+ 個容器) 而不影響效能

## 7. 安全考量

- 在執行破壞性操作 (如 rm、rm -f) 前必須要求使用者確認
- 驗證容器 ID 的有效性
- 適當處理權限不足的情況

## 8. 未來擴展性

設計時應考慮未來可能的功能擴展：
- 支援 Docker Compose
- 容器監控功能
- 批次操作
- 配置檔案支援