<Project Sdk="Microsoft.NET.Sdk.Web">

    <PropertyGroup>
        <TargetFramework>net9.0</TargetFramework>
        <Nullable>enable</Nullable>
        <ImplicitUsings>enable</ImplicitUsings>
        <DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
        <!-- Force source generator output for better IDE support -->
        <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
        <CompilerGeneratedFilesOutputPath>Generated</CompilerGeneratedFilesOutputPath>
    </PropertyGroup>

    <ItemGroup>
        <Protobuf Include="Protos\greet.proto" GrpcServices="Both"/>
    </ItemGroup>
    
    <ItemGroup>
        <AdditionalFiles Include="Protos\greet.proto" />
    </ItemGroup>

    <ItemGroup>
        <PackageReference Include="Grpc.AspNetCore" Version="2.64.0"/>
    </ItemGroup>

    <ItemGroup>
      <Content Include="..\.dockerignore">
        <Link>.dockerignore</Link>
      </Content>
    </ItemGroup>

    <ItemGroup>
      <ProjectReference Include="..\T1.GrpcProtoGenerator\T1.GrpcProtoGenerator.csproj" OutputItemType="Analyzer" ReferenceOutputAssembly="false" />
      <Analyzer Include="..\T1.GrpcProtoGenerator\bin\Debug\netstandard2.0\T1.GrpcProtoGenerator.dll" />
    </ItemGroup>

    <ItemGroup>
      <Folder Include="Generated\" />
    </ItemGroup>

    <!-- Simple solution: Disable default compile items and manually control what gets compiled -->
    <PropertyGroup>
        <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    </PropertyGroup>
    
    <!-- Manually include source files we want to compile -->
    <ItemGroup>
        <Compile Include="Program.cs" />
        <Compile Include="Services\**\*.cs" Condition="Exists('Services')" />
    </ItemGroup>
    
    <!-- Include generated files as content for browsing only -->
    <ItemGroup>
        <Content Include="Generated\**\*.cs">
            <CopyToOutputDirectory>Never</CopyToOutputDirectory>
        </Content>
    </ItemGroup>

</Project>
